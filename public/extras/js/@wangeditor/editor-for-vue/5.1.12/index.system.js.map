{"version":3,"file":"index.system.js","sources":["../src/utils/create-info.ts","../src/components/Editor.vue","../src/components/Toolbar.vue"],"sourcesContent":["/**\n * @description 错误提示信息\n * @author liuqh\n */\nexport function genErrorInfo(fnName: string): string {\n  let info = `请使用 '@${fnName}' 事件，不要放在 props 中`\n  info += `\\nPlease use '@${fnName}' event instead of props`\n  return info\n}","<template>\n  <div ref=\"box\" style=\"height: 100%\"></div>\n</template>\n\n<script lang=\"ts\">\nimport { onMounted, defineComponent, ref, PropType, toRaw, watch, shallowRef } from 'vue'\nimport { createEditor, IEditorConfig, SlateDescendant, IDomEditor } from '@wangeditor/editor'\nimport { genErrorInfo } from '../utils/create-info'\n\nexport default defineComponent({\n  props: {\n    /** 编辑器模式 */\n    mode: {\n      type: String,\n      default: 'default',\n    },\n    /** 编辑器默认内容 */\n    defaultContent: {\n      type: Array as PropType<SlateDescendant[]>,\n      default: [],\n    },\n    defaultHtml: {\n      type: String,\n      default: '',\n    },\n    /** 编辑器默认配置 */\n    defaultConfig: {\n      type: Object as PropType<Partial<IEditorConfig>>,\n      default: {},\n    },\n    /* 自定义 v-model */\n    modelValue: {\n      type: String,\n      default: '',\n    },\n  },\n  setup(props, context) {\n    const box = ref(null) // 编辑器容器\n\n    const editorRef = shallowRef<null | IDomEditor>(null) // editor 实例，必须用 shallowRef\n\n    const curValue = ref('') // 记录 editor 当前 html 内容\n\n    /**\n     * 初始化编辑器\n     */\n    const initEditor = () => {\n      if (!box.value) return\n      // 获取原始数据，解除响应式特性\n      const defaultContent = toRaw(props.defaultContent)\n\n      createEditor({\n        selector: box.value! as Element,\n        mode: props.mode,\n        content: defaultContent || [],\n        html: props.defaultHtml || props.modelValue || '',\n        config: {\n          ...props.defaultConfig,\n          onCreated(editor) {\n            editorRef.value = editor // 记录 editor 实例\n\n            context.emit('onCreated', editor)\n\n            if (props.defaultConfig.onCreated) {\n              const info = genErrorInfo('onCreated')\n              throw new Error(info)\n            }\n          },\n          onChange(editor) {\n            const editorHtml = editor.getHtml()\n            curValue.value = editorHtml // 记录当前内容\n            context.emit('update:modelValue', editorHtml) // 触发 v-model 值变化\n\n            context.emit('onChange', editor)\n            if (props.defaultConfig.onChange) {\n              const info = genErrorInfo('onChange')\n              throw new Error(info)\n            }\n          },\n          onDestroyed(editor) {\n            context.emit('onDestroyed', editor)\n            if (props.defaultConfig.onDestroyed) {\n              const info = genErrorInfo('onDestroyed')\n              throw new Error(info)\n            }\n          },\n          onMaxLength(editor) {\n            context.emit('onMaxLength', editor)\n            if (props.defaultConfig.onMaxLength) {\n              const info = genErrorInfo('onMaxLength')\n              throw new Error(info)\n            }\n          },\n          onFocus(editor) {\n            context.emit('onFocus', editor)\n            if (props.defaultConfig.onFocus) {\n              const info = genErrorInfo('onFocus')\n              throw new Error(info)\n            }\n          },\n          onBlur(editor) {\n            context.emit('onBlur', editor)\n            if (props.defaultConfig.onBlur) {\n              const info = genErrorInfo('onBlur')\n              throw new Error(info)\n            }\n          },\n          customAlert(info, type) {\n            context.emit('customAlert', info, type)\n            // @ts-ignore\n            if (props.defaultConfig.customAlert) {\n              const info = genErrorInfo('customAlert')\n              throw new Error(info)\n            }\n          },\n          customPaste: (editor, event): any => {\n            if (props.defaultConfig.customPaste) {\n              const info = genErrorInfo('customPaste')\n              throw new Error(info)\n            }\n            let res\n            context.emit('customPaste', editor, event, (val: boolean) => {\n              res = val\n            })\n            return res\n          },\n        },\n      })\n    }\n\n    /**\n     * 设置 HTML\n     * @param newHtml new html\n     */\n    function setHtml(newHtml: string) {\n      const editor = editorRef.value\n      if (editor == null) return\n      editor.setHtml(newHtml)\n    }\n\n    /**\n     * 元素挂在后初始化编辑器\n     */\n    onMounted(() => {\n      initEditor()\n    })\n\n    // 监听 v-model 值变化\n    watch(\n      () => props.modelValue,\n      newVal => {\n        if (newVal === curValue.value) return // 和当前内容一样，则忽略\n\n        // 重新设置 HTML\n        setHtml(newVal)\n      }\n    )\n\n    return {\n      box,\n    }\n  },\n})\n</script>\n","<template>\n  <div ref=\"selector\"></div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, ref, watchEffect, PropType } from 'vue'\nimport { createToolbar, IToolbarConfig, IDomEditor, DomEditor } from '@wangeditor/editor'\n\nexport default defineComponent({\n  props: {\n    // editor 实例\n    editor: {\n      type: Object as PropType<IDomEditor>\n    },\n    /** 编辑器模式 */\n    mode: {\n      type: String,\n      default: 'default',\n    },\n    /** 编辑器默认配置 */\n    defaultConfig: {\n      type: Object as PropType<Partial<IToolbarConfig>>,\n      default: {},\n    },\n  },\n  setup(props) {\n    // toolbar 容器\n    const selector = ref(null)\n\n    /**\n     * 初始化 toolbar\n     */\n    const create = (editor: IDomEditor) => {\n      if (!selector.value) return\n      if (editor == null) {\n        throw new Error('Not found instance of Editor when create <Toolbar/> component')\n      }\n      if (DomEditor.getToolbar(editor)) return // 不重复创建\n\n      createToolbar({\n        editor,\n        selector: (selector.value! as Element) || '<div></div>',\n        mode: props.mode,\n        config: props.defaultConfig,\n      })\n    }\n\n    watchEffect( () => {\n      const { editor } = props\n      if (editor == null) return\n      create(editor) // 初始化 toolbar\n    })\n\n    return {\n      selector,\n    }\n  },\n})\n</script>\n"],"names":["genErrorInfo","fnName","info","_sfc_main$1","defineComponent","props","context","box","ref","editorRef","shallowRef","curValue","defaultContent","toRaw","editor","editorHtml","type","info2","event","res","val","setHtml","newHtml","onMounted","newVal","_hoisted_1","_sfc_main","selector","create","DomEditor","createToolbar","watchEffect"],"mappings":"mVAAO,SAASA,EAAaC,EAAQ,CACnC,IAAIC,EAAO,wBAAwBD,CAAM,4DACzC,OAAAC,GAAQ;AAAA,eACKD,CAAM,2BACZC,CACT,CCEA,IAAAC,EAAeC,EAAgB,QAG3B,KAAK,CACH,KAAM,OACN,QAAI,WAGN,eAAC,CACC,KAAM,MACN,QAAS,CAAE,CACX,cACW,CACZ,KAAA,OACC,QAAS,IAGX,cAAC,CACC,KAAM,OACN,QAAS,CAAE,CACX,EAEF,WAAC,CACA,KAAO,OACN,QAAU,WAGXC,EAAAC,EAAA,CACF,MAAAC,EAAAC,EAAA,IAAA,EACOC,EAAYC,EAAE,IAAA,EACdC,EAAWH,EAAG,EAAG,SAErB,GAAI,CAACD,EAAI,aAET,MAAMK,EAAiBC,EAAMR,EAAK,cAAW,KAE7C,SAAAE,EAAA,MACE,KAAIF,EAAA,KACN,QAAAO,GAAA,CAAA,EACE,KAAMP,EAAK,aAAUA,EAAA,YAAA,UACb,CACN,GAAGA,EAAM,cACT,UAAUS,EAAO,CAGf,aADAR,EAAO,KAAA,YAAAQ,CAAA,EACHT,EAAM,cAAc,UAAG,CACzB,MAAMH,EAAIF,EAAA,WAAA,EACV,MAAM,IAAI,MAAME,CAAK,EAExB,EACD,SAASY,EAAQ,CACf,MAAMC,EAAUD,EAAA,aAChBH,EAAS,MAAOI,gCAEhBT,EAAQ,KAAK,WAAWQ,CAAO,4BAE5B,MAAKZ,EAAOF,EAAa,UAAO,EACjC,MAAM,IAAK,MAAKE,CAAI,CACpB,CACF,EACF,YAACY,EAAA,CAEC,GADAR,EAAQ,KAAK,cAAEQ,CAAA,EACXT,EAAM,cAAc,YAAU,CAChC,MAAMH,EAAOF,EAAa,aAAQ,EAClC,MAAM,IAAI,MAAME,CAAI,EAEtB,EACA,YAAUY,EAAQ,CAEhB,GADAR,EAAM,KAAK,cAAeQ,CAAM,EAC9BT,EAAM,cAAY,YAAA,CACtB,MAAAH,EAAAF,EAAA,aAAA,EACD,MAAA,IAAA,MAAAE,CAAA,CACE,CACD,EACA,QAAMY,EAAQ,CAEZ,GADAR,EAAM,KAAK,UAAWQ,CAAM,EAC1BT,EAAM,cAAY,QAAA,CACtB,MAAAH,EAAAF,EAAA,SAAA,EACD,MAAA,IAAA,MAAAE,CAAA,CACE,CACD,EACA,OAAKY,EAAQ,CAEX,GADAR,EAAM,KAAK,SAAUQ,CAAM,EACzBT,EAAM,cAAY,OAAA,CACtB,MAAAH,EAAAF,EAAA,QAAA,EACD,MAAA,IAAA,MAAAE,CAAA,CACE,GAED,YAAUA,EAAMc,EAAM,CAEpB,GADAV,EAAM,KAAK,cAAeJ,EAAMc,CAAG,EACjCX,EAAM,cAAY,YAAA,CACtB,MAAAY,EAAAjB,EAAA,aAAA,EACD,MAAA,IAAA,MAAAiB,CAAA,CACE,GAED,YAAW,CAACH,EAAQI,IAAU,CAC5B,GAAEb,EAAM,cAAc,YAAY,CAClC,MAAMH,EAAOF,EAAO,aAAA,EACtB,MAAA,IAAA,MAAAE,CAAA,CACD,CACC,IAAIiB,EACJ,OAAAb,EAAQ,KAAK,cAAeQ,EAAQI,EAAEE,GAAA,CACrCD,EAAOC,CACR,CAAC,EACKD,CACJ,CACF,GAEF,EACE,SAACE,EAAQC,EAAS,CAChB,MAAAR,EAAOL,EAAU,SAGlB,QAAKa,CAAA,EAEJ,OAAAC,EAAA,IAAM,IAER,CAAA,QAEHlB,EAAA,WACFmB,GAAA,CACHA,IAAAb,EAAA,OAEEU,EAAAG,CAAA,CACC,CACF,EACC,CACA,IAAAjB,EAEA,yEAvIW,MAAAkB,EAAA,CAAA,IAAA,4MCIjBC,EAAetB,EAAgB,QAG3B,OAAK,MACG,MACP,EAED,KAAC,CACC,KAAM,OACN,QAAI,WAGN,cAAC,CACC,KAAM,OACN,QAAS,CAAE,UAGZC,EAAA,CACF,MAAAsB,EAAAnB,EAAA,IAAA,EACOoB,EAAKd,GAAA,CACV,GAAMa,EAAK,kBAGV,MAAA,IAAA,MAAA,+DAAA,EAEAE,EAAA,WAAAf,CAAA,GAEAgB,EAAc,CACX,OAAAhB,EACD,SAAUa,EAAS,OAAS,cAC9B,KAAAtB,EAAA,YACUA,EAAM,gBAEhB,EACE,OAAA0B,EAAM,IAAA,MACF,CAAE,OAAAjB,CAAQ,EAAGT,EACfS,GAAU,MAEdc,EAACd,CAAA,CACH,CAAA,GAEE,SAAAa,CACA,CACA"}